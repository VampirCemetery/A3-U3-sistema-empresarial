<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Productos</title>
</head>

<body>
  <div th:replace="layout :: *">
    <div th:fragment="content">
      <h3 class="mb-3">Productos</h3>
      <div class="row">
        <div class="col-lg-8">
          <div class="table-responsive">
            <table id="tbl" class="table table-bordered table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Código</th>
                  <th>Nombre</th>
                  <th>Categoría</th>
                  <th>Precio venta</th>
                  <th>Stock</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="p : ${productos}">
                  <td th:text="${p.codigo}">COD</td>
                  <td th:text="${p.nombre}">Nombre</td>
                  <td th:text="${p.categoria != null ? p.categoria.nombre : '-'}">Cat</td>
                  <td th:text="${p.precioVenta}">0.0</td>
                  <td th:text="${p.stockActual}">0</td>
                  <td class="d-flex gap-1">
                    <form th:action="@{'/inventario/productos/' + ${p.id} + '/ajustar'}" method="post"
                      class="d-flex gap-1">
                      <input type="number" class="form-control form-control-sm p-1" name="delta" placeholder="+/-"
                        required style="width:70px; font-size: 0.8rem;">
                      <input class="form-control form-control-sm p-1" name="motivo" placeholder="Motivo" required
                        style="font-size: 0.8rem;">
                      <button class="btn btn-sm btn-outline-primary py-0 px-2"
                        style="font-size: 0.8rem;">Ajustar</button>
                    </form>
                    <form th:action="@{'/inventario/productos/' + ${p.id} + '/delete'}" method="post"
                      onsubmit="return confirm('¿Eliminar?')">
                      <button class="btn btn-sm btn-danger py-0 px-2" style="font-size: 0.8rem;"><i
                          class="fa-solid fa-trash"></i></button>
                    </form>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <div class="card-body p-3">
              <h6 class="mb-3">Nuevo producto</h6>
              <form method="post" th:object="${producto}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row g-2">
                  <div class="col-6">
                    <label class="form-label small mb-1">Código</label>
                    <input class="form-control form-control-sm" th:field="*{codigo}" required>
                    <div class="text-danger small" th:errors="*{codigo}"></div>
                  </div>
                  <div class="col-6">
                    <label class="form-label small mb-1">Nombre</label>
                    <input class="form-control form-control-sm" th:field="*{nombre}" required>
                    <div class="text-danger small" th:errors="*{nombre}"></div>
                  </div>
                  <div class="col-12">
                    <label class="form-label small mb-1">Categoría</label>
                    <select class="form-select form-select-sm" th:field="*{categoria}" required>
                      <option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.nombre}"></option>
                    </select>
                    <div class="text-danger small" th:errors="*{categoria}"></div>
                  </div>
                  <div class="col-6">
                    <label class="form-label small mb-1">Precio venta</label>
                    <input type="number" step="0.01" class="form-control form-control-sm" th:field="*{precioVenta}"
                      required>
                    <div class="text-danger small" th:errors="*{precioVenta}"></div>
                  </div>
                  <div class="col-6">
                    <label class="form-label small mb-1">Precio compra</label>
                    <input type="number" step="0.01" class="form-control form-control-sm" th:field="*{precioCompra}">
                    <div class="text-danger small" th:errors="*{precioCompra}"></div>
                  </div>
                  <div class="col-12">
                    <label class="form-label small mb-1">Stock inicial</label>
                    <input type="number" class="form-control form-control-sm" th:field="*{stockActual}" value="0">
                    <div class="text-danger small" th:errors="*{stockActual}"></div>
                  </div>
                </div>
                <button class="btn btn-primary w-100 btn-sm mt-3">Guardar</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <script> new DataTable('#tbl'); </script>
    </div>
  </div>
</body>

</html>